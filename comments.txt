//////////////////       The tasks that are remaining until now.       ////////////////////////

const selectDateRef = useRef(null);
ref={selectDateRef}
onClick={() => selectDateRef.current?.showPicker()}


1. DGM sir needed on entry form adding buyer and styles ok
2. Maruf sir needed operator hourly rejection
3. All input from server.  






bar- name & process
paredo- id & process
defect report operator wise. date range and total.  -- (ok) /admin/defects/search

ekta operator kon line e koto ghonta kaj kortese today date e.

ekta operator kon line e koto din kaj korese. setar report

ekta line e sorbo nimno 18 din or  manual date e koto jon kaj korese tar list ebong oi mase ki kono absent royese ki na (ok)

operator join date operator kono report khele  ebong operator chole gele se ki karone gese. tar ekta report thakbe (ok)

add pie chart on machine report (ui)

leave operator report.

koto jon operator helper e kortese. ebong koto jon helper  operatory kortese tar ekta report toiri korte hobe.

operator er sorbocho ebong second sorbocho process production. (ok)

npt.























Reports

/admin/occurrence-report/search --
reports/heighest-process-score 
/reports/line-report
/reports/machine-report (machine report updatable)------------------
/reports/operator-pressent-absent-report (payrol data correction) -- 
/reports/search-by-process
/reports/supervisor-report 
/reports/floor-wise-breakdown-matching
/reports/date-range-operator-search 
/reports/operator-work --

/reports/floor-line-wise-report (problem ui&ux)


top-10-process scorer list ---------



entry form

/admin/buyers
/admin/styles
/admin/defects
/admin/defects/search --
/admin/floor
/admin/floor-lines
admin/hourly-production-entry
/admin/hours
/admin/machine-parts-upload --
/admin/machine-types
/admin/machines
/admin/occurrence-report/add --
/admin/operators
/admin/operators/update
/admin/resign
/admin/supervisors
/reports/breackdown-check-1


supervisor entry

/supervisor/daily-production
/supervisor/delete-daily-production-entry
/supervisor/line-completion
/supervisor/processes
/supervisor/reposition
/supervisor/update-daily-production







ekhane process gulo evabe sajate hobe. excell ta ki tumi notun ekta excell e convert korte parba nicher moto kore

Operator Name  , 	ID No. ,           	Designation	 ,    Grade	 ,  Update Matrix,   Join Date,    	Salary, process																																																		 
AMIR    HAMJA,	TGS-005716	JR. ,     OPERATOR,	  A,	                    A,	           4-Mar-20, 	9715,  {"Placket box":171,"Side vent top stitch":103,"Zipper join":100,"Moon join":157} 




























ekhane ui te aro koyekta information add korte hobe. jeta niche deoa hoilo
1. chairmen certificate (eta check box hobe)
2. Education Certificate (eta check boc hobe)
3. experience Machine Name (SNLS/DNLS, Over Lock, Flat Lock(egulo prottektai checkbox hobe))
4. Others (eta input hobe)



// app/admin/iep-interview/2nd-step

'use client';

import { useState, useEffect } from 'react';
import NidOrBirthCertificateSearch from '@/components/NidOrBirthCertificate';

export default function InterviewStepOne() {
  const [candidates, setCandidates] = useState([]);
  const [selectedCandidate, setSelectedCandidate] = useState('');
  const [loading, setLoading] = useState(false);
  const [message, setMessage] = useState('');
  const [selectedCandidateData, setSelectedCandidateData] = useState(null);
  const [failureReason, setFailureReason] = useState('');
  const [showReasonInput, setShowReasonInput] = useState(false);
  
  // Search related states
  const [showSearch, setShowSearch] = useState(false);
  const [searchValue, setSearchValue] = useState('');
  const [searchKey, setSearchKey] = useState(0);

  // Fetch candidates on component mount
  useEffect(() => {
    fetchCandidates();
  }, []);

  const fetchCandidates = async () => {
    try {
      setLoading(true);

      // Step one ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶¨ candidate ‡¶®‡¶æ‡¶ì
      const response = await fetch('/api/iep-interview/step-one-get');
      const stepOneData = await response.json();

      console.log('Raw API response:', stepOneData); // Debugging

      // Validate data structure - ensure required fields exist
      const validatedCandidates = stepOneData.filter(candidate => 
        candidate && 
        candidate.candidateId && 
        candidate.name // name must exist
      );

      // Log invalid candidates for debugging
      const invalidCandidates = stepOneData.filter(candidate => 
        !candidate || !candidate.candidateId || !candidate.name
      );
      
      if (invalidCandidates.length > 0) {
        console.warn('Invalid candidates found:', invalidCandidates);
      }

      // Already marked candidates ‡¶®‡¶æ‡¶ì
      const responseMarked = await fetch('/api/iep-interview/iep-interview-down-admin/get');
      const markedData = await responseMarked.json();
      const markedCandidateIds = markedData.map(c => c.candidateId);

      // Filter out those candidates ‡¶Ø‡¶æ‡¶∞‡¶æ already marked ‡¶Ö‡¶•‡¶¨‡¶æ FAILED
      const filteredCandidates = validatedCandidates.filter(
        c => !markedCandidateIds.includes(c.candidateId) && c.result !== "FAILED"
      );

      if (response.ok) {
        setCandidates(filteredCandidates);
        console.log('Filtered candidates:', filteredCandidates); // Debugging
      } else {
        setMessage('Failed to fetch candidates');
      }
    } catch (error) {
      console.error('Error fetching candidates:', error);
      setMessage('Error fetching candidates');
    } finally {
      setLoading(false);
    }
  };

  const handleCandidateChange = (e) => {
    const candidateId = e.target.value;
    setSelectedCandidate(candidateId);
    
    const candidate = candidates.find(c => c.candidateId === candidateId);
    
    if (candidate) {
      // Validate required fields
      if (!candidate.name) {
        console.error('Selected candidate missing name:', candidate);
        setMessage('Error: Selected candidate data is incomplete');
        setSelectedCandidateData(null);
        return;
      }
      
      setSelectedCandidateData(candidate);
      // Reset failure reason when candidate changes
      setFailureReason('');
      setShowReasonInput(false);
      setMessage(''); // Clear any previous messages
    } else {
      setSelectedCandidateData(null);
    }
  };

  // Search button click handler
  const handleSearch = () => {
    if (!selectedCandidateData) {
      alert('Please select a candidate first');
      return;
    }

    // Validate candidate data
    if (!selectedCandidateData.name) {
      alert('Selected candidate data is invalid');
      return;
    }

    const nidValue = selectedCandidateData.nid?.trim();
    const birthCertValue = selectedCandidateData.birthCertificate?.trim();
    
    if (!nidValue && !birthCertValue) {
      alert('Selected candidate does not have NID or Birth Certificate number');
      return;
    }
    
    // NID ‡¶ï‡ßá priority ‡¶¶‡¶ø‡¶¨‡ßá
    const searchValueToUse = nidValue || birthCertValue;
    setSearchValue(searchValueToUse);
    setSearchKey(prev => prev + 1);
    setShowSearch(true);
  };

  const handleResultUpdate = async (resultValue) => {
    if (!selectedCandidate) {
      setMessage('Please select a candidate first');
      return;
    }

    // Validate candidate data
    if (!selectedCandidateData || !selectedCandidateData.name) {
      setMessage('Invalid candidate data. Please select a valid candidate.');
      return;
    }

    // ‡¶Ø‡¶¶‡¶ø FAILED ‡¶π‡ßü ‡¶è‡¶¨‡¶Ç reason ‡¶®‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü
    if (resultValue === 'FAILED' && !failureReason.trim()) {
      setMessage('Please provide a reason for failure');
      return;
    }

    try {
      setLoading(true);
      setMessage('');
      
      // Prepare validated data with fallbacks for required fields
      const requestData = {
        candidateId: selectedCandidate,
        result: resultValue,
        interviewData: {
          ...selectedCandidateData,
          name: selectedCandidateData.name || 'Unknown',
          nid: selectedCandidateData.nid || null,
          birthCertificate: selectedCandidateData.birthCertificate || null,
          // Ensure all required fields have values
          candidateId: selectedCandidateData.candidateId || selectedCandidate
        },
        failureReason: resultValue === 'FAILED' ? failureReason : null
      };

      console.log("Sending validated data:", requestData);
      
      const response = await fetch('/api/iep-interview/iep-interview-down-admin', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(requestData),
      });
      
      const result = await response.json();
      console.log('Update response status:', response.status);
      console.log('Update response data:', result);
      
      if (response.ok) {
        setMessage(`Candidate successfully marked as ${resultValue}`);
        setSelectedCandidate('');
        setSelectedCandidateData(null);
        setFailureReason('');
        setShowReasonInput(false);
        fetchCandidates(); // Refresh the list
      } else {
        // More detailed error message
        if (result.errors) {
          const errorDetails = Object.values(result.errors).join(', ');
          setMessage(`Validation error: ${errorDetails}`);
        } else {
          setMessage(result.error || `Failed to update result: ${response.status}`);
        }
      }
    } catch (error) {
      console.error('Error updating result:', error);
      setMessage(`Network error: ${error.message}`);
    } finally {
      setLoading(false);
    }
  };

  const handleFailedButtonClick = () => {
    if (!selectedCandidate || !selectedCandidateData) {
      setMessage('Please select a candidate first');
      return;
    }
    
    setShowReasonInput(true);
    // Automatically focus on the reason input when it appears
    setTimeout(() => {
      document.getElementById('failureReason')?.focus();
    }, 100);
  };

  const handlePassedButtonClick = () => {
    if (!selectedCandidate || !selectedCandidateData) {
      setMessage('Please select a candidate first');
      return;
    }
    
    setShowReasonInput(false);
    setFailureReason('');
    handleResultUpdate('PASSED');
  };

  const handleConfirmFailed = () => {
    handleResultUpdate('FAILED');
  };

  const handleCancelFailed = () => {
    setShowReasonInput(false);
    setFailureReason('');
  };

  return (
    <div className="min-h-screen bg-gray-50 mt-10 py-8">
      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="bg-white rounded-lg shadow-md p-6">
          <h1 className="text-2xl font-bold text-gray-900 mb-6">
            Assessment Part - Step Two (Admin )
          </h1>

          {/* Candidate Selection */}
          <div className="mb-6">
            <label htmlFor="candidate" className="block text-sm font-medium text-gray-700 mb-2">
              Select Candidate
            </label>
            <select
              id="candidate"
              value={selectedCandidate}
              onChange={handleCandidateChange}
              className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
              disabled={loading}
            >
              <option value="">Choose a candidate...</option>
              {candidates.map((candidate) => {
                // Validate required fields before rendering
                if (!candidate.name || !candidate.candidateId) {
                  console.warn('Invalid candidate data:', candidate);
                  return null;
                }
                
                return (
                  <option key={candidate._id} value={candidate.candidateId}>
                    {candidate.candidateId} - {candidate.name} 
                    {candidate.nid && ` - NID: ${candidate.nid}`}
                    {candidate.birthCertificate && ` - Birth Cert: ${candidate.birthCertificate}`}
                    {(!candidate.nid && !candidate.birthCertificate) && ' - No ID available'}
                  </option>
                );
              })}
            </select>
            {candidates.length === 0 && !loading && (
              <p className="text-sm text-gray-500 mt-2">
                No candidates available for interview.
              </p>
            )}
          </div>

          {/* Selected Candidate Details */}
          {selectedCandidateData && (
            <div className="mb-6 p-4 bg-gray-50 rounded-lg">
              <div className="flex justify-between items-start mb-3">
                <h3 className="text-lg font-semibold text-gray-900">
                  Candidate Details
                </h3>
                
                {/* Search Button */}
                <button 
                  onClick={handleSearch}
                  disabled={!selectedCandidateData.nid && !selectedCandidateData.birthCertificate}
                  className="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white px-4 py-2 rounded-md font-medium transition-colors flex items-center gap-2 text-sm"
                >
                  <span>üîç View Details</span>
                </button>
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <p><strong>Name:</strong> {selectedCandidateData.name || 'N/A'}</p>
                  <p><strong>Candidate ID:</strong> {selectedCandidateData.candidateId || 'N/A'}</p>
                  {selectedCandidateData.nid ? (
                    <p><strong>NID:</strong> {selectedCandidateData.nid}</p>
                  ) : selectedCandidateData.birthCertificate ? (
                    <p><strong>Birth Certificate:</strong> {selectedCandidateData.birthCertificate}</p>
                  ) : (
                    <p className="text-red-500 text-sm">
                      ‚ö†Ô∏è No NID or Birth Certificate available for search
                    </p>
                  )}
                </div>
                {selectedCandidateData.picture && (
                  <div>
                    <p><strong>Picture:</strong></p>
                    <img 
                      src={selectedCandidateData.picture} 
                      alt={selectedCandidateData.name || 'Candidate'}
                      className="w-24 h-24 object-cover rounded-md mt-2"
                      onError={(e) => {
                        e.target.style.display = 'none';
                      }}
                    />
                  </div>
                )}
              </div>
            </div>
          )}

          {/* Search Component */}
          {showSearch && (
            <div className="mb-6">
              <NidOrBirthCertificateSearch 
                key={searchKey}
                nidOrBirthCertificateValue={searchValue}
                autoSearch={true}
              />
            </div>
          )}

          {/* Failure Reason Input - ‡¶∂‡ßÅ‡¶ß‡ßÅ failed ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá show ‡¶π‡¶¨‡ßá */}
          {showReasonInput && (
            <div className="mb-4 p-4 bg-red-50 rounded-lg border border-red-200">
              <label htmlFor="failureReason" className="block text-sm font-medium text-red-700 mb-2">
                Reason for Failure *
              </label>
              <textarea
                id="failureReason"
                value={failureReason}
                onChange={(e) => setFailureReason(e.target.value)}
                placeholder="Please provide the reason why the candidate failed..."
                className="w-full px-3 py-2 border border-red-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500"
                rows="3"
                disabled={loading}
              />
              <div className="flex gap-2 mt-3">
                <button
                  onClick={handleConfirmFailed}
                  disabled={!failureReason.trim() || loading}
                  className="bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  {loading ? 'Submitting...' : 'Confirm Failed'}
                </button>
                <button
                  onClick={handleCancelFailed}
                  disabled={loading}
                  className="bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 disabled:opacity-50"
                >
                  Cancel
                </button>
              </div>
            </div>
          )}

          {/* Action Buttons */}
          {selectedCandidateData && !showReasonInput && (
            <div className="flex gap-4 mb-4">
              <button
                onClick={handlePassedButtonClick}
                disabled={!selectedCandidate || loading}
                className="flex-1 bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {loading ? 'Processing...' : 'Mark as PASSED'}
              </button>
              
              <button
                onClick={handleFailedButtonClick}
                disabled={!selectedCandidate || loading}
                className="flex-1 bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {loading ? 'Processing...' : 'Mark as Failed'}
              </button>
            </div>
          )}

          {/* Message Display */}
          {message && (
            <div className={`p-3 rounded-md ${
              message.includes('successfully') || message.includes('PASSED')
                ? 'bg-green-100 text-green-800' 
                : 'bg-red-100 text-red-800'
            }`}>
              {message}
            </div>
          )}

          {/* Loading State */}
          {loading && (
            <div className="text-center py-4">
              <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
              <p className="text-sm text-gray-600 mt-2">Processing...</p>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}


// models/iepInterviewDownAdmin.js

import mongoose from 'mongoose';

const candidateSchema = new mongoose.Schema({
  name: {
    type: String,
    required: true
  },
  nid: {
    type: String,
    required: true
  },
  picture: String,
  birthCertificate: String,
  stepCompleted: {
    type: Number,
    default: 1
  },
  candidateId: {
    type: String,
    required: true,
    unique: true
  },
  status: {
    type: String,
    enum: ['pending', 'passed', 'failed'],
    default: 'pending'
  }
}, {
  timestamps: true
});

export default mongoose.models.Candidate || mongoose.model('Candidate', candidateSchema);


import { connectDB } from '@/lib/db';
import Candidate from '@/models/Candidate';
import { NextResponse } from 'next/server';

export async function POST(request) {
  try {
    await connectDB();
    
    const {candidateId, result, interviewData, failureReason, nid, name} = await request.json();
    console.log(failureReason);
    
    const cadidate = await Candidate.create({candidateId, result, interviewData, failureReason, nid, name});
    console.log("Created candidate:", cadidate);
    return NextResponse.json({
      success: true,
      data: cadidate,
      message: 'Candidate interview data successfully created'
    }, { status: 201 });
  }
  catch (error) {
    return NextResponse.json({
      success: false,
      error: error.message
    }, { status: 400 });
  }
    
    
}




SNLS/DNLS machine er khetre jemon condition rakha hoise. ekhon OverLock ebong Flat Lock er khetre arekta condition apply  korte hobe. 

1. "OverLock" er khetre process jodi "Neck-join" hoy ebong capacity jodi 150 er upore hoy tahole se mark pabe 100, jodi capacity 120 er upore pay tahole mark 80, jodi capacity 100 er upore pay tahole 60, jodi capacity 80 er upore pay tahole 50. er niche capacity hole mark 0.
2. OverLock er khetre process jodi Neck join betito onno kono process hoy ebong capacity jodi 80 er upore hoy tahole se mark pabe 80, jodi capacity 70 er upore pay tahole mark 60, jodi capacity 60 er upore pay tahole 50, er niche capacity hole mark 0.

3. "Flat Lock" er khetre process jodi Bottom-hem hoy ebong capacity jodi 220 er upore hoy tahole se mark pabe 100, jodi capacity 200 er upore pay tahole mark 80, jodi capacity 180 er upore pay tahole 60, jodi capacity 160 er upore pay tahole 50. er niche capacity hole mark 0.
4. "Flat Lock" er khetre process jodi Bottom-hem betito onno kono process hoy ebong capacity jodi 120 er upore hoy tahole se mark pabe 80, jodi capacity 100 er upore pay tahole mark 60, jodi capacity 90 er upore pay tahole 50, er niche capacity hole mark 0.




const fourProcessAndMachine = [
    { name: "Pocket join (Kangaro)", minCapacity: 90, machine: "SNLS/DNLS" },
    { name: "Placket box", minCapacity: 90, machine: "SNLS/DNLS" },
    { name: "Zipper join(2nd)", minCapacity: 60, machine: "SNLS/DNLS" },
    { name: "Back neck tape top stitch insert label", minCapacity: 120, machine: "SNLS/DNLS" }
]; 
  
  const processesWithCalculations = data.processes.map(process => {
    const processName = process.processName;  
    const machine = process.machineType;
    
    const validCycleTimes = process.cycleTimes.filter(time => time > 0);
    const avgCycleTime = validCycleTimes.length > 0 
      ? validCycleTimes.reduce((a, b) => a + b, 0) / validCycleTimes.length 
      : 0;
    const target = 60 / process.smv;
    const capacity = 3600 / avgCycleTime;
    const performance = (capacity / target) * 100;

    let practicalMarks = 0;

    console.log("Process:", processName);
    console.log("Machine:", machine);
    console.log("AvgCycleTime:", avgCycleTime.toFixed(2), "Capacity:", capacity.toFixed(2), "Performance:", performance.toFixed(2));

    // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶∏‡¶¨ SNLS/DNLS ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶æ‡¶∞ data collect ‡¶ï‡¶∞‡¶ø
    const snlsProcesses = data.processes.filter(p => p.machineType === "SNLS/DNLS");
    
    if (machine === "SNLS/DNLS") {
        let passedCount = 0;
        
        // ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶æ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶ø
        fourProcessAndMachine.forEach(fp => {
            // ‡¶∏‡¶Ç‡¶∂‡ßç‡¶≤‡¶ø‡¶∑‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶æ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶ø
            const matchingProcess = snlsProcesses.find(p => p.processName === fp.name);
            if (matchingProcess) {
                const processCapacity = 3600 / (matchingProcess.cycleTimes.filter(t => t > 0).reduce((a, b) => a + b, 0) / matchingProcess.cycleTimes.filter(t => t > 0).length);
                if (processCapacity >= fp.minCapacity) {
                    passedCount++;
                }
            }
        });
        
        console.log("SNLS/DNLS Total PassedCount:", passedCount);

        if (passedCount === 4) practicalMarks = 100;
        else if (passedCount === 3) practicalMarks = 80;
        else if (passedCount === 2) practicalMarks = 60;
        else if (passedCount === 1) practicalMarks = 50;
        else practicalMarks = 30;
    }
    // ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶Æ‡ßá‡¶∂‡¶ø‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶∏‡ßç‡¶ï‡ßã‡¶∞‡¶ø‡¶Ç
    else {
        if (performance > 90) practicalMarks = 100;
        else if (performance >= 80) practicalMarks = 80;
        else if (performance >= 70) practicalMarks = 70;
        else if (performance >= 60) practicalMarks = 60;
        else if (performance >= 50) practicalMarks = 50;
        else practicalMarks = 0;
    }

    console.log("Final PracticalMarks:", practicalMarks);
    console.log("-----------------------------");

    return {
      ...process,
      avgCycleTime,
      target,
      capacity,
      performance,
      practicalMarks
    };
});



















ei model er jonno DailyProduction entry korar jonno keta page banaite hobe. 
page ta hobe emon  buyer, style, supervisor, floor, line egulo input ekbar e dite hobe. niche ekta table thakbe.

table er column e thakbe operator, uniqueMachine, process, workAs, target.
uporer data gulo table er protekta column er jonno projojjo.

ekhon ekhane scanner system toiri korte hobe. operator er qr code scan korle operator er field e uthbe, machine e scan korle machine er filed e uthbe. jodi operator er qr code scan hoy tahole sob field soho row barbe. ek nagare dui bar machine er qr code scane korle warning dibe. jodi ager machine change korte chay othoba vul kore chapse tahole seta cancel korbe.


tahole prothome to amader operator ebong machine er jonno qr code toiri korte hobe. qr code gulo kemon hobe. ebong vitore ki ki totho rakhte hobe. jeno sohojei detect korte pare eta machine er jonno qr code, r  eta operator er jonno qr code.

next js app router, tailwind, js.


/api/operators
[ 
{
    "_id": "69258b775e6458462523106f",
    "name": "Sabbir Ahmed",
    "operatorId": "TGS-01105233",
    "joiningDate": "2025-11-25T00:00:00.000Z",
    "nid": "1997208723487",
    "picture": "/uploads/photos/9aafe80a-a4fc-42f2-bb9e-a908222c269d.jpg",
    "videos": [],
    "designation": "OPERATOR",
    "grade": "A++",
    "allowedProcesses": {
      "Bottom hem": 248,
      "Neck join": 206,
      "Zipper join(2nd)": 65
    },
    "occurrenceReports": [],
    "resignationHistory": [],
    "previousProcessScores": [],
    "createdAt": "2025-11-25T10:56:55.268Z",
    "updatedAt": "2025-11-25T10:56:55.268Z",
    "__v": 0
  }
]

/api/machines

[
  {
    "_id": "68a990fd36f3b4854012713b",
    "uniqueId": "LOCK STITCH-01",
    "machineType": {
      "_id": "68a9908d36f3b48540127130",
      "name": "LOCK STITCH",
      "description": "",
      "createdAt": "2025-08-23T09:57:33.547Z",
      "__v": 0
    },
    "currentStatus": "idle",
    "createdAt": "2025-08-23T09:59:25.378Z",
    "__v": 0,
    "servicingConfig": {
      "customInterval": 2,
      "isNotificationActive": true,
      "lastServiced": "2025-10-16T00:00:00.000Z",
      "nextServiceDate": "2025-10-18T00:00:00.000Z",
      "defaultInterval": 15
    },
    "parts": [
      {
        "partName": "Oil Filter",
        "uniquePartId": "LOCK STITCH-01-Oil Filter",
        "defaultIntervalDays": 5,
        "customIntervalDays": 2,
        "lastServicedDate": "2025-10-21T05:59:39.405Z",
        "nextServiceDate": "2025-10-21T18:00:00.000Z",
        "isNotificationActive": true,
        "createdAt": "2025-10-20T08:09:46.882Z"
      },
      {
        "partName": "neddle-guard",
        "uniquePartId": "LOCK STITCH-01-neddle-guard",
        "defaultIntervalDays": 15,
        "customIntervalDays": 4,
        "lastServicedDate": "2025-11-23T09:24:19.892Z",
        "nextServiceDate": "2025-11-27T00:00:00.000Z",
        "isNotificationActive": true,
        "createdAt": "2025-10-21T07:38:19.460Z"
      },
      {
        "partName": "ghdf",
        "uniquePartId": "LOCK STITCH-01-ghdf",
        "defaultIntervalDays": 15,
        "customIntervalDays": null,
        "lastServicedDate": "2025-10-22T06:15:18.153Z",
        "nextServiceDate": "2025-10-22T18:00:00.000Z",
        "isNotificationActive": true,
        "createdAt": "2025-10-21T13:04:08.970Z"
      },
      {
        "partName": "gd4dfg",
        "uniquePartId": "LOCK STITCH-01-gd4dfg",
        "defaultIntervalDays": 15,
        "customIntervalDays": null,
        "lastServicedDate": "2025-10-22T06:18:07.965Z",
        "nextServiceDate": "2025-10-22T18:00:00.000Z",
        "isNotificationActive": true,
        "createdAt": "2025-10-21T13:04:21.000Z"
      },
      {
        "partName": "dg45t5",
        "uniquePartId": "LOCK STITCH-01-dg45t5",
        "defaultIntervalDays": 15,
        "customIntervalDays": 4,
        "lastServicedDate": "2025-11-23T06:05:13.012Z",
        "nextServiceDate": "2025-11-26T18:00:00.000Z",
        "isNotificationActive": true,
        "createdAt": "2025-10-21T13:04:30.965Z"
      },
      {
        "partName": "ddfg465hf",
        "uniquePartId": "LOCK STITCH-01-ddfg465hf",
        "defaultIntervalDays": 15,
        "customIntervalDays": 7,
        "lastServicedDate": "2025-11-23T08:59:32.230Z",
        "nextServiceDate": "2025-11-29T18:00:00.000Z",
        "isNotificationActive": true,
        "createdAt": "2025-10-21T13:04:42.207Z"
      },
      {
        "partName": "fhf78",
        "uniquePartId": "LOCK STITCH-01-fhf78",
        "defaultIntervalDays": 15,
        "customIntervalDays": null,
        "lastServicedDate": null,
        "nextServiceDate": "2025-10-18T18:00:00.000Z",
        "isNotificationActive": true,
        "createdAt": "2025-10-21T13:04:53.134Z"
      },
      {
        "partName": "dfgdf78gh",
        "uniquePartId": "LOCK STITCH-01-dfgdf78gh",
        "defaultIntervalDays": 15,
        "customIntervalDays": null,
        "lastServicedDate": null,
        "nextServiceDate": "2025-10-18T18:00:00.000Z",
        "isNotificationActive": true,
        "createdAt": "2025-10-21T13:05:13.124Z"
      },
      {
        "partName": "fgh676gh",
        "uniquePartId": "LOCK STITCH-01-fgh676gh",
        "defaultIntervalDays": 15,
        "customIntervalDays": null,
        "lastServicedDate": "2025-10-22T05:19:39.829Z",
        "nextServiceDate": "2025-10-21T18:00:00.000Z",
        "isNotificationActive": true,
        "createdAt": "2025-10-21T13:05:25.517Z"
      },
      {
        "partName": "fghu67bjy",
        "uniquePartId": "LOCK STITCH-01-fghu67bjy",
        "defaultIntervalDays": 15,
        "customIntervalDays": null,
        "lastServicedDate": "2025-10-22T05:08:53.477Z",
        "nextServiceDate": "2025-10-21T18:00:00.000Z",
        "isNotificationActive": true,
        "createdAt": "2025-10-21T13:05:36.543Z"
      }
    ],
    "lastLocation": {
      "date": "2025-11-08T04:38:57.116Z",
      "line": "N/A",
      "supervisor": "N/A",
      "floor": "N/A",
      "updatedAt": "2025-11-08T04:38:57.116Z"
    }
  }










const mongoose = require('mongoose');

const HourlyProductionSchema = new mongoose.Schema({
  hour: { type: String, required: true },
  productionCount: { type: Number, required: true },
  defects: [{
    defectId: { type: mongoose.Schema.Types.ObjectId, ref: 'Defect' },
    name: { type: String },
    code: { type: String },
    count: { type: Number, default: 0 } // ‚úÖ Defect count field ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
  }]
});

const DailyProductionSchema = new mongoose.Schema({
  date: { type: Date, required: true },
  operator: { 
    type: {
      _id: { type: mongoose.Schema.Types.ObjectId, ref: 'Operator' },
      operatorId: { type: String },
      name: { type: String },
      designation: { type: String },
    },
    required: true 
  },
  supervisor: { type: String, required: true },
  floor: { type: String, required: true },
  line: { type: String, required: true },
  process: { type: String, required: true },
  machineType: { type: String },
  uniqueMachine: { type: String },
  target: { type: Number },
  buyerId: { type: mongoose.Schema.Types.ObjectId, ref: 'Buyer', required: true },
  styleId: { type: mongoose.Schema.Types.ObjectId, ref: 'Style', required: true },
  workAs: { type: String, enum: ['operator', 'helper'], required: true },
  hourlyProduction: [HourlyProductionSchema],
  createdAt: { type: Date, default: Date.now }
});

module.exports = mongoose.models.DailyProduction || mongoose.model('DailyProduction', DailyProductionSchema);


